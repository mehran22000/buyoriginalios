/****************************************************************************** 
 * Licensed Materials - Property of IBM 
 * "Restricted Materials of IBM"
 * ?? Copyright IBM Corp. 2014 All Rights Reserved. 
 * 
 * Copying, redistribution and/or modification is prohibited. 
 * U.S. Government Users Restricted Rights - Use, duplication or 
 * disclosure restricted by GSA ADP Schedule Contract with IBM Corp. 
 *****************************************************************************/
var MAC={timeLastEventFired:0,validate:function(c,b){try{if(window.AccNativeInterface){if(c!="MAC_ios_init"){MAC.log("Accessibility: validating using the javascript interface for android");AccNativeInterface.uploadInterface(c,b)}}else{MAC.log("Accessibility: javascript interface not available, try a11y_validate protocol for ios");var a='{"htmlName" : "'+c+'", "htmlString" : "'+b+'" }';var f=new XMLHttpRequest();f.open("GET","http://a11y_validation/"+encodeURIComponent(a));f.send(null)}}catch(d){MAC.log("Accessibility: error in validate() "+d)}},log:function(b){if(window.AccNativeInterface){console.log(b)}else{var a=new XMLHttpRequest();a.open("GET","http://a11y_debugger/"+encodeURIComponent(b));a.send(null)}},attachListeners:function(){try{if(!window||!window.document){return}var g=window.document;if(a){a.disconnect()}var f="MutationObserver" in window;var c=window.MutationObserver||window.WebKitMutationObserver||window.MozMutationObserver;MAC.log("Accessibility: canObserveMutation="+f+", MutationObserver="+c);var a=new c(MAC.onDomModified);var b={childList:true,attributes:false,subtree:true};a.observe(g.body,b);MAC.validate("MAC_ios_init","<html></html>");MAC.onDomModified()}catch(d){MAC.log("Accessibility: error in attachListeners"+d)}},onDomModified:function(b){var a=Date.now();if(a-MAC.timeLastEventFired<750){return}MAC.timeLastEventFired=a;var j=2000;var l=window.location.pathname;if(b){j=2000;MAC.log("Accessibility: Html Dom changed! path="+l);var h=false;b.forEach(function(m){if(m.attributeName=="acccustom"||m.attributeName=="style"){h=true}});if(h){MAC.log("Accessibility: ignore the change!")}}else{MAC.log("Accessibility: onLoad! source="+l)}try{var c=window.document;if(!c||!c.body||c.body.innerHTML.trim()==""){MAC.log("Accessibility: nothing to validate, ignore. source="+l);return""}var k=new XMLSerializer();var d=k.serializeToString(c);d=unescape(encodeURIComponent(d));var g=l.substring(l.lastIndexOf("/")+1);if(g==null||g==""){g="HtmlData"}g=(!c.title)?g+"&&":g+"&&"+c.title;MAC.log("Accessibility: path="+l+", page="+g);window.setTimeout(function(){MAC.validate(g,d)},j)}catch(f){MAC.log("Accessibility: error in onDomModified: "+f)}},setNodeBoundsAndStyle:function(b){try{if(!b){return}var a=MAC.getElementBounds(b);if(a){b.setAttribute("acccustom",a)}if(b.hasChildNodes()){var d=b.firstChild;while(d){if(d.nodeType===1&&d.nodeName!="SCRIPT"&&d.nodeName!="BR"&&d.nodeName!="P"){MAC.setNodeBoundsAndStyle(d)}d=d.nextSibling}}}catch(c){MAC.log("Accessibility: error in setNodeBoundsAndStyle: "+c)}},getElementBounds:function(g){try{var f=g.getBoundingClientRect();if(f){var a=f.left.toFixed(0);var k=f.top.toFixed(0);var b=f.width||(f.right-f.left);var c=f.height||(f.bottom-f.top);b=b.toFixed(0);c=c.toFixed(0);var d='{"bounds":[['+a+","+k+"],["+b+","+c+"]]}";if(g.nodeName=="BODY"){d='{"bodybounds":[['+a+","+k+"],["+b+","+c+"]]}"}return d}else{MAC.log("rect is not available.")}}catch(j){MAC.log("Accessibility: error in setElementBounds: "+j)}},getElementStyle:function(d){try{var k=d.getAttribute("style");if(k){k=k.replace(/ /g,"")}var a=getComputedStyle(d);if(a){var g="";var f=a.getPropertyValue("color");if(f&&f!=""&&(!k||k.indexOf("color:")==-1)){g+="color:"+f+";"}var j=a.getPropertyValue("background-color");if(j&&j!=""&&(!k||k.indexOf("background-color:")==-1)){g+="background-color:"+j+";"}var h=a.getPropertyValue("background-image");if(h&&h!=""&&(!k||k.indexOf("background-image:")==-1)){g+="background-image:"+h+";"}var m=a.getPropertyValue("opacity");if(m&&m!=""&&(!k||k.indexOf("opacity:")==-1)){g+="opacity:"+m+";"}var l=a.getPropertyValue("font-family");if(l&&l!=""&&(!k||k.indexOf("font-family:")==-1)){g+="font-family:"+l+";"}var c=a.getPropertyValue("font-size");if(c&&c!=""&&(!k||k.indexOf("font-size:")==-1)){g+="font-size:"+c+";"}var b=a.getPropertyValue("font-style");if(b&&b!=""&&(!k||k.indexOf("font-style:")==-1)){g+="font-style:"+b+";"}var o=a.getPropertyValue("font-weight");if(b&&b!=""&&(!k||k.indexOf("font-weight:")==-1)){g+="font-weight:"+o+";"}if(k){if(k.indexOf(";",(k.length-1))==-1){k+=";"}}else{k=""}return k+g}else{MAC.log("The computed style is not available")}}catch(n){MAC.log("Accessibility: error in setElementStyle: "+n)}},createXPathFromElement:function(e){var c=document.getElementsByTagName("*");for(var b=[];e&&e.nodeType==1;e=e.parentNode){if(e.hasAttribute("id")){var a=0;for(var d=0;d<c.length;d++){if(c[d].hasAttribute("id")&&c[d].id==e.id){a++}if(a>1){break}}if(a==1){b.unshift('id("'+e.getAttribute("id")+'")');return b.join("/")}else{b.unshift(e.localName.toLowerCase()+'[@id="'+e.getAttribute("id")+'"]')}}else{if(e.hasAttribute("class")){b.unshift(e.localName.toLowerCase()+'[@class="'+e.getAttribute("class")+'"]')}else{for(i=1,sib=e.previousSibling;sib;sib=sib.previousSibling){if(sib.localName==e.localName){i++}}b.unshift(e.localName.toLowerCase()+"["+i+"]")}}}return b.length?"/"+b.join("/"):null},getElementByXPath:function(c,b){var d=new XPathEvaluator();var a=d.evaluate(b,c,null,XPathResult.FIRST_ORDERED_NODE_TYPE,null);return a.singleNodeValue}};